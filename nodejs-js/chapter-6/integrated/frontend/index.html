<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2-FA Test Server</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { display: flex; justify-content: space-between; align-items: center; background: #222; color: #fff; padding: 16px 24px; }
    .auth-buttons { display: flex; gap: 8px; }
    main { display: flex; flex-direction: column; align-items: center; margin-top: 60px; }
    .user-box { margin-top: 24px; display: flex; align-items: center; gap: 8px; }
    input[type="text"] { padding: 6px 10px; font-size: 1rem; }
    .userinfo-table { border-collapse: collapse; width: 100%; margin-top: 8px; }
    .userinfo-table td, .userinfo-table th { border: 1px solid #888; padding: 6px 12px; }
  </style>
</head>
<body>
  <header>
    <h1 style="margin:0;font-size:1.5rem;">2-FA Test Server</h1>
    <div class="auth-buttons">
      <div class="user-box">
        <label for="username">Username:</label>
        <input type="text" id="username" placeholder="Enter username">
      </div>
      <button id="loginBtn">Login</button>
      <button id="logoutBtn">Logout</button>
    </div>
    <script>
      const usernameInput = document.getElementById('username');
      const loginBtn = document.getElementById('loginBtn');
      const logoutBtn = document.getElementById('logoutBtn');

      loginBtn.addEventListener('click', () => {
        window.location = '/oauth/login';
      });

      logoutBtn.addEventListener('click', () => {
        window.location = '/oauth/logout';
        usernameInput.value = '';
      });
    </script>
  </header>
  <main>
    <div id="userinfo" style="margin-left:24px;color:#000;"></div>
    <script>
      async function fetchUserInfo() {
        try {
          const res = await fetch('/userinfo');
          if (!res.ok) throw new Error('Not logged in');
          const data = await res.json();
          console.log(data);
          const userinfoDiv = document.getElementById('userinfo');
          userinfoDiv.innerHTML = '<strong>User Info:</strong><br><table class="userinfo-table">' +
          Object.entries(data).map(([key, value]) =>
            `<tr><td>${key}</td><td>${value}</td></tr>`
          ).join('') +
          '</table>';
          usernameInput.value = data?.name || data?.sub || '';
        } catch (err) {
          document.getElementById('userinfo').innerHTML = `<span class="userinfo-error">${err.message}</span>`;
          usernameInput.value = '';
        }
      }
      fetchUserInfo();
    </script>
  </main>
</body>
</html>